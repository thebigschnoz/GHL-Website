{% extends 'GHLWebsiteApp/layout.html' %}
{% load static %}
{% block title %} - Commissioner Tools{% endblock %}

{% block body %}
<center><div class="section section_lg">
  <h1>Commissioner Tools</h1>

  {% if messages %}
    <ul class="messages">
      {% for message in messages %}
        <li class="{{ message.tags }}">{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}

  <p>
    Current season:
    <strong><font style="color: #e4b61a; text-decoration-line: underline; text-decoration-style: dotted;">{{ season.season_text }}</font></strong>
    <i>({{ season.get_season_type_display }})</i>
  </p>

  <hr>

  <h2>Seasonal Rotation</h2>

    {% if season.season_type == "regular" %}
    <p>
      <i>
          Generate the playoff bracket from the current regular-season standings
          and switch the season to <strong><font style="color: #e4b61a;">Playoffs</font></strong>.
      </i>
    </p>
    <form method="post" action="{% url 'start_playoffs' %}">
      {% csrf_token %}
      <button type="submit"
              onclick="return confirm('This will generate the playoff bracket and switch the season to Playoffs. This cannot be undone easily. Continue?');"
              class="btn-submit">
        Start Playoffs / Generate Bracket
      </button>
    </form>

    {% elif season.season_type == "playoffs" %}
    <p>
        <i>
        Advance to the next playoff round once all series in the current round
        have a recorded winner.
        </i>
    </p>
    <form method="post" action="{% url 'advance_round' %}">
        {% csrf_token %}
        <button type="submit"
                onclick="return confirm('This will create the next playoff round from the current round winners. Make sure all series have a winner recorded. Continue?');"
                class="btn-submit">
        Advance to Next Playoff Round
        </button>
    </form>

    {% else %}
    <p>
      Playoff generation is only available when the season is in
      <strong>Regular Season</strong> state. Current state:
      <strong>{{ season.get_season_type_display }}</strong>.
    </p>
    {% endif %}

<hr>

<h2>Signups</h2>

<p>
  Current season: <strong>{{ season.season_text }}</strong><br>
  Signups are currently:
  {% if season.signups_open %}
    <span style="color: #4CAF50; font-weight: bold;">OPEN</span>
  {% else %}
    <span style="color: #f44336; font-weight: bold;">CLOSED</span>
  {% endif %}
</p>

<form method="post" style="margin-bottom: 1rem;">
  {% csrf_token %}
  {% if season.signups_open %}
    <button type="submit" name="signup_action" value="close" class="btn-submit">
      Close Signups
    </button>
  {% else %}
    <button type="submit" name="signup_action" value="open" class="btn-submit">
      Open Signups
    </button>
  {% endif %}
</form>

<form action="{% url 'signup_list' %}" method="get">
    <button type="submit" class="btn-submit">View Signup List</button>
</form>

<h3>Signup Summary</h3>

<p>Total signups: <strong>{{ total_signups }}</strong></p>

<div style="display:flex; gap:40px; flex-wrap:wrap; justify-content:center;">
  <div>
    <h4>Primary</h4>
    <table class="standingstable">
      <tr><th>Pos</th><th>Count</th></tr>
      {% for row in primary_breakdown %}
        <tr>
          <td>{{ row.primary_position__positionShort }}</td>
          <td>{{ row.count }}</td>
        </tr>
      {% empty %}
        <tr><td colspan="3">No signups yet.</td></tr>
      {% endfor %}
    </table>
  </div>

  <div>
    <h4>Secondary</h4>
    <table class="standingstable">
      <tr><th>Pos</th><th>Count</th></tr>
      {% for row in secondary_breakdown %}
        {% if row.secondary_positions__positionShort %}
          <tr>
            <td>{{ row.secondary_positions__positionShort }}</td>
            <td>{{ row.count }}</td>
          </tr>
        {% endif %}
      {% empty %}
        <tr><td colspan="3">No signups yet.</td></tr>
      {% endfor %}
    </table>
  </div>
</div>
  
  <hr>

  <h2>Other Tools (coming soon)</h2>
  <ul>
    <li>Move to off season</li>
    <li>Start a new regular season</li>
    <li>Draft tools</li>
    <li>Season Schedule Generation</li>
  </ul>
</div></center>
{% endblock %}

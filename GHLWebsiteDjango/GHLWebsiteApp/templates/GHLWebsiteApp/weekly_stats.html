{% extends "GHLWebsiteApp/layout.html" %}
{% block title %} - Weekly Stats{% endblock %}

{% block body %}
<center>
<div class="section section_lg" style="justify-items: center;">
    <div class="header">Weekly Stats</div>

    <form method="get">
        <label for="week-select">Select Week:</label>
        <select name="week" id="week-select" onchange="this.form.submit()">
            {% for w in weeks %}
                <option value="{{ w|date:'Y-m-d' }}" {% if selected_week == w %}selected{% endif %}>
                    {{ w|date:"Y-m-d" }}
                </option>
            {% endfor %}
        </select>
    </form>
    {% if players_for_week %}
    <div class="section">
        <h3>Weekly Three Stars</h3>
        <form id="three-stars-form" method="post" style="margin-top: 1rem;">
            {% csrf_token %}
            <!-- Carry the selected week through POST -->
            <input type="hidden" name="week" value="{{ selected_week|date:'Y-m-d' }}">
            <div class="three-stars-row">
                <label for="first_star">1st Star:</label>
                <select name="first_star" id="first_star" form="three-stars-form" required>
                    <option value="">-- Select player --</option>
                    {% for p in players_for_week %}
                        <option value="{{ p.id }}"
                            {% if three_stars and three_stars.first_star_id == p.id %}selected{% endif %}>
                            {{ p.username }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="three-stars-row">
                <label for="second_star">2nd Star:</label>
                <select name="second_star" id="second_star" form="three-stars-form" required>
                    <option value="">-- Select player --</option>
                    {% for p in players_for_week %}
                        <option value="{{ p.id }}"
                            {% if three_stars and three_stars.second_star_id == p.id %}selected{% endif %}>
                            {{ p.username }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="three-stars-row">
                <label for="third_star">3rd Star:</label>
                <select name="third_star" id="third_star" form="three-stars-form" required>
                    <option value="">-- Select player --</option>
                    {% for p in players_for_week %}
                        <option value="{{ p.id }}"
                            {% if three_stars and three_stars.third_star_id == p.id %}selected{% endif %}>
                            {{ p.username }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="three-stars-row">
                <label for="blurb">Write-up:</label>
                <textarea name="blurb" id="blurb" rows="3" form="three-stars-form">
                    {{ three_stars.blurb|default_if_none:"" }}
                </textarea>
            </div>

            <button type="submit"
                    name="save_three_stars"
                    form="three-stars-form"
                    class="btn btn-primary">
                Save Three Stars
            </button>
            </div>
        </form>
    </div>
    {% elif three_stars %}
    <div class="section">
        <div class="header">Weekly Three Stars</div>
        <p>
            ⭐ 1st Star: <b>{{ three_stars.first_star.username }}</b><br>
            ⭐⭐ 2nd Star: <b>{{ three_stars.second_star.username }}</b><br>
            ⭐⭐⭐ 3rd Star: <b>{{ three_stars.third_star.username }}</b>
        </p>
        {% if three_stars.blurb %}
            <p><i>{{ three_stars.blurb }}</i></p>
        {% endif %}
    </div>
    {% endif %}

    {% if skater_stats %}
      <h3>Skater Stats</h3>
      <div class="standings-scroll"><table class="fullstandings sortable">
        <tr>
            <th>Player</th>
            <th>GP</th>
            <th>G</th>
            <th>A</th>
            <th>Pts</th>
            <th>S%</th>
            <th>+/-</th>
            <th>Hits</th>
            <th>Poss Avg</th>
            <th>Pass %</th>
            <th>TK/GP</th>
            <th>INT/GP</th>
            <th>BLK/GP</th>
        </tr>
        {% for s in skater_stats %}
        <tr>
            <td class="hoverlink"><a href="{% url 'player' s.ea_player_num %}">{{ s.player_name }}</a></td>
            <td style="width: 40px;">{{ s.games_played }}</td>
            <td style="width: 40px;">{{ s.total_goals }}</td>
            <td style="width: 40px;">{{ s.total_assists }}</td>
            <td style="width: 40px;">{{ s.total_points }}</td>
            <td style="width: 40px;">{{ s.shot_perc|floatformat:1 }}%</td>
            <td style="width: 40px;">{{ s.plus_minus }}</td>
            <td style="width: 40px;">{{ s.hits }}</td>
            <td style="width: 40px;">{{ s.postime|floatformat:0 }}</td>
            <td style="width: 40px;">{{ s.pass_perc|floatformat:1 }}%</td>
            <td style="width: 40px;">{{ s.tkpergame|floatformat:2 }}</td>
            <td style="width: 40px;">{{ s.intpergame|floatformat:2 }}</td>
            <td style="width: 40px;">{{ s.bspergame|floatformat:2 }}</td>
        </tr>
        {% endfor %}
    </table></div>
    
    <h3>Goalie Stats</h3>
    <div class="standings-scroll"><table class="fullstandings sortable">
        <tr>
            <th>Player</th>
            <th>GP</th>
            <th>SA</th>
            <th>SV</th>
            <th>SV%</th>
            <th>GAA</th>
            <th>SO</th>
        </tr>
        {% for g in goalie_stats %}
        <tr>
            <td class="hoverlink"><a href="{% url 'player' g.ea_player_num %}">{{ g.player_name }}</a></td>
            <td style="width: 40px;">{{ g.games_played }}</td>
            <td style="width: 40px;">{{ g.shots_against }}</td>
            <td style="width: 40px;">{{ g.saves }}</td>
            <td style="width: 40px;">{{ g.svp|floatformat:1 }}%</td>
            <td style="width: 40px;">{{ g.gaa|floatformat:2 }}</td>
            <td style="width: 40px;">{{ g.shutouts }}</td>
        </tr>
        {% endfor %}
    </table></div>
    {% else %}
        <p>No stats for this week.</p>
    {% endif %}    
</div></center>
{% endblock %}

{% extends "GHLWebsiteApp/layout.html" %}
{% block title %} - Weekly Stats{% endblock %}

{% block body %}
<center>
<div class="section section_lg" style="justify-items: center;">
    <div class="header">Weekly Stats</div>

    <form method="get">
        <label for="week-select">Select Week:</label>
        <select name="week" id="week-select" onchange="this.form.submit()">
            {% for w in weeks %}
                <option value="{{ w|date:'Y-m-d' }}" {% if selected_week == w|date:'Y-m-d' %}selected{% endif %}>
                    {{ w|date:"Y-m-d" }}
                </option>
            {% endfor %}
        </select>
    </form>
    {% if players_for_week %}
    <div class="section">
        <div class="header">Weekly Three Stars</div>
        <form method="post">
            {% csrf_token %}
            <table class="fullstandings">
                <colgroup>
                    <col style="width: 120px;">
                    <col>
                </colgroup>
                <tr>
                    <th>Star</th>
                    <th>Player</th>
                </tr>
                <tr>
                    <td>⭐ 1st Star</td>
                    <td>
                        <select name="first_star">
                            <option value="">---------</option>
                            {% for p in players_for_week %}
                                <option value="{{ p.id }}"
                                    {% if three_stars and three_stars.first_star_id == p.id %}selected{% endif %}>
                                    {{ p.username }}
                                </option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>⭐⭐ 2nd Star</td>
                    <td>
                        <select name="second_star">
                            <option value="">---------</option>
                            {% for p in players_for_week %}
                                <option value="{{ p.id }}"
                                    {% if three_stars and three_stars.second_star_id == p.id %}selected{% endif %}>
                                    {{ p.username }}
                                </option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
                <tr>
                    <td>⭐⭐⭐ 3rd Star</td>
                    <td>
                        <select name="third_star">
                            <option value="">---------</option>
                            {% for p in players_for_week %}
                                <option value="{{ p.id }}"
                                    {% if three_stars and three_stars.third_star_id == p.id %}selected{% endif %}>
                                    {{ p.username }}
                                </option>
                            {% endfor %}
                        </select>
                    </td>
                </tr>
            </table>
            <div style="margin-top: 8px;">
                <label for="id_blurb"><b>Write-up / notes (optional):</b></label><br>
                <textarea id="id_blurb" name="blurb" rows="3" cols="70">{% if three_stars %}{{ three_stars.blurb }}{% endif %}</textarea>
            </div>
            <div style="margin-top: 8px;">
                <button type="submit" name="save_three_stars">Save Three Stars</button>
            </div>
        </form>
    </div>
    {% elif three_stars %}
    <div class="section">
        <div class="header">Weekly Three Stars</div>
        <p>
            ⭐ 1st Star: <b>{{ three_stars.first_star.username }}</b><br>
            ⭐⭐ 2nd Star: <b>{{ three_stars.second_star.username }}</b><br>
            ⭐⭐⭐ 3rd Star: <b>{{ three_stars.third_star.username }}</b>
        </p>
        {% if three_stars.blurb %}
            <p><i>{{ three_stars.blurb }}</i></p>
        {% endif %}
    </div>
    {% endif %}

    {% if skater_stats %}
      <h3>Skater Stats</h3>
      <div class="standings-scroll"><table class="fullstandings sortable">
        <tr>
            <th>Player</th>
            <th>GP</th>
            <th>G</th>
            <th>A</th>
            <th>Pts</th>
            <th>S%</th>
            <th>+/-</th>
            <th>Hits</th>
            <th>Poss Avg</th>
            <th>Pass %</th>
            <th>TK/GP</th>
            <th>INT/GP</th>
            <th>BLK/GP</th>
        </tr>
        {% for s in skater_stats %}
        <tr>
            <td class="hoverlink"><a href="{% url 'player' s.ea_player_num %}">{{ s.player_name }}</a></td>
            <td style="width: 40px;">{{ s.games_played }}</td>
            <td style="width: 40px;">{{ s.total_goals }}</td>
            <td style="width: 40px;">{{ s.total_assists }}</td>
            <td style="width: 40px;">{{ s.total_points }}</td>
            <td style="width: 40px;">{{ s.shot_perc|floatformat:1 }}%</td>
            <td style="width: 40px;">{{ s.plus_minus }}</td>
            <td style="width: 40px;">{{ s.hits }}</td>
            <td style="width: 40px;">{{ s.postime|floatformat:0 }}</td>
            <td style="width: 40px;">{{ s.pass_perc|floatformat:1 }}%</td>
            <td style="width: 40px;">{{ s.tkpergame|floatformat:2 }}</td>
            <td style="width: 40px;">{{ s.intpergame|floatformat:2 }}</td>
            <td style="width: 40px;">{{ s.bspergame|floatformat:2 }}</td>
        </tr>
        {% endfor %}
    </table></div>
    
    <h3>Goalie Stats</h3>
    <div class="standings-scroll"><table class="fullstandings sortable">
        <tr>
            <th>Player</th>
            <th>GP</th>
            <th>SA</th>
            <th>SV</th>
            <th>SV%</th>
            <th>GAA</th>
            <th>SO</th>
        </tr>
        {% for g in goalie_stats %}
        <tr>
            <td class="hoverlink"><a href="{% url 'player' g.ea_player_num %}">{{ g.player_name }}</a></td>
            <td style="width: 40px;">{{ g.games_played }}</td>
            <td style="width: 40px;">{{ g.shots_against }}</td>
            <td style="width: 40px;">{{ g.saves }}</td>
            <td style="width: 40px;">{{ g.svp|floatformat:1 }}%</td>
            <td style="width: 40px;">{{ g.gaa|floatformat:2 }}</td>
            <td style="width: 40px;">{{ g.shutouts }}</td>
        </tr>
        {% endfor %}
    </table></div>
    {% else %}
        <p>No stats for this week.</p>
    {% endif %}    
</div></center>
{% endblock %}
